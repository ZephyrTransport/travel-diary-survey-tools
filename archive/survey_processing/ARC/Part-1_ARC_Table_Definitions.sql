--ARC Project on coding tours and trips using Regional Household Travel Survey Data
--Part-1: Create tables and insert initial data FROM the respective *.csv files. 
--NOTE : Before inserting data FROM *.csv files to SQL Server,
--		 make sure that there are no commas in the *.csv files in the Inputs folder
--Palvinder Singh			10/24/2012			singhp@pbworld.com
----------------------------------------------------------------------------------------


SET NOCOUNT ON;	
PRINT 'Part - 1 is being executed and start time of the process is : ' + CAST(SYSDATETIME() AS VARCHAR)
--------------------------------------------------------------------
--START - Initial setup before running the script to create tables                   
---------------------------------------------------------------------

--Removing any existing table FROM previous runs
IF OBJECT_ID('dbo.HH') IS NOT NULL 
	DROP TABLE dbo.HH;
IF OBJECT_ID('dbo.Person') IS NOT NULL 
	DROP TABLE dbo.Person;
IF OBJECT_ID('dbo.Place') IS NOT NULL 
	DROP TABLE dbo.Place;
IF OBJECT_ID('dbo.actpriority') IS NOT NULL 
	DROP TABLE dbo.actpriority;	
IF OBJECT_ID('dbo.TotalTourFile') IS NOT NULL 
	DROP TABLE dbo.TotalTourFile;
IF OBJECT_ID('dbo.TotalTripFile') IS NOT NULL 
	DROP TABLE dbo.TotalTripFile;
IF OBJECT_ID('dbo.ReqdTable') IS NOT NULL 
	DROP TABLE dbo.ReqdTable;
---------------------------------------------------------------------
--END - Initial setup before running the script to create tables                   
---------------------------------------------------------------------

----------------------
--START - Input Tables
----------------------
--Create HH table and insert data FROM HH.csv file
CREATE TABLE dbo.HH (
	SAMPN int,
	RECMODE int,
	RETMODE int,
	CTFIP int,
	AREAT int,
	ASSN int,
	DOW int,
	ILANG int,
	GTYPE int,
	GFLAG int,
	RESTY int,
	O_RESTY VARCHAR(75),
	OWN int,
	O_OWN VARCHAR(75),
	HHSIZ int,
	NONRELAT int,
	HHVEH int,
	VEHOP int,
	VEHPR int,
	LTELE int,
	INCOME int,
	RACE int,
	O_RACE VARCHAR(75),
	HISP int,
	HISP2 int,
	INCEN int,
	HHSTU int,
	HHWRK int,
	HHLIC int,
	HHCHD int,
	HHLIFE int,
	HTRIPS int,
	FUTUR int,
	HTAZ int,
	HXCORD real,
	HYCORD real,
	HHPARTIAL int,
	HHWGT real,
	EXPHHWGT real,
	CONSTRAINT HH_pkey PRIMARY KEY (SAMPN)
);
BULK INSERT dbo.HH FROM "D:\Projects\ARC\Household_Travel_Data\HH.csv" WITH (
	FIELDTERMINATOR = ',', ROWTERMINATOR = '\n', FIRSTROW = 2, MAXERRORS = 0, TABLOCK);
----------------------------------------------------------------------------------------
--Create Person table and insert data FROM PER.csv file	
CREATE TABLE dbo.Person (
	SAMPN int,
	PERNO int,
	GENDER int,
	AGE int,
	AGEB int,
	LIC int,
	CTELE int,
	RELAT int,
	DISAB int,
	DTYPE1 int,
	DTYPE2 int,
	DTYPE3 int,
	DTYPE4 int,
	DTYPE5 int,
	O_DTYPE VARCHAR(100),
	EMPLY int,
	VOLUN int,
	WORKS int,
	WKSTAT int,
	O_WKSTAT VARCHAR(100),
	JOBS int,
	HOURS int,
	HOURS2 int,
	HOURS3 int,
	TELWK int,
	TCHRS int,
	WSTRT int,
	WEND int,
	SCHED int,
	WDAYS int,
	COMPR int,
	O_COMPR VARCHAR(100),
	INDUS int,
	O_INDUS VARCHAR(100),
	OCCUP int,
	O_OCCUP VARCHAR(100),
	EMPLR int,
	O_EMPLR VARCHAR(100),
	EPARK int,
	EPPK2 int,
	UPARK int,
	ETRANS int,
	WLOC int,
	WNAME VARCHAR(100),
	WTAZ int,
	WXCORD real,
	WYCORD real,
	WMODE int,
	O_WMODE VARCHAR(100),
	EDUCA int,
	O_EDUCA VARCHAR(100),
	STUDE int,
	SCHOL int,
	O_SCHOL VARCHAR(100),
	SLOC int,
	SONLN int,
	SNAME VARCHAR(100),
	STAZ int,
	SXCORD real,
	SYCORD real,
	SMODE int,
	O_SMODE VARCHAR(100),
	RIBUS int,
	BREZ int,
	BREZF int,
	O_BREZF VARCHAR(100),
	GRTA int,
	GRTAF int,
	CGTP int,
	CGTPF int,
	DISFR int,
	O_DISFR VARCHAR(100),
	FBKTW int,
	INTRV int,
	PROXY int,
	CMPLG int,
	HVLOG int,
	PTRIPS int,
	NOGO int,
	O_NOGO VARCHAR(100),
	INCOMPLETE_FLAG int,
	CTFIP int,
	PWGT real,
	EXPPWGT real,
	CONSTRAINT Person_pkey PRIMARY KEY (PERNO, SAMPN)
);
BULK INSERT dbo.Person FROM "D:\Projects\ARC\Household_Travel_Data\PER.csv" WITH (
	FIELDTERMINATOR = ',', ROWTERMINATOR = '\n', FIRSTROW = 2, MAXERRORS = 0, TABLOCK);
----------------------------------------------------------------------------------------
--Create Place table and insert data FROM PLACE.csv file
CREATE TABLE dbo.Place (
	SAMPN int,
	PERNO int,
	PLANO int,
	PNAME VARCHAR(100),
	TPURP int,
	O_TPURP VARCHAR(100),
	TPUR2 int,
	O_TPURP2 VARCHAR(100),
	MODE int,
	O_MODE VARCHAR(100),
	TOTTR int,
	HHMEM int,
	PER1 int,
	PER2 int,
	PER3 int,
	PER4 int,
	PER5 int,
	NONHH int,
	VEHNO int,
	HOVL int,
	TOLL int,
	DYGOV int,
	PLOC int,
	PRKTY int,
	O_PRKTY VARCHAR(100),
	PAYPK int,
	PKAMT real,
	PKUNT real,
	ROUTE VARCHAR(100),
	SERVC real,
	O_SERVC VARCHAR(100),
	FARE int,
	O_FARE real,
	FAREC real,
	ARR_HR int,
	ARR_MIN int,
	DEP_HR int,
	DEP_MIN int,
	ACTDUR int,
	TRPDUR int,
	TRIPDIST real,
	PTAZ int,
	XCORD real,
	YCORD real,
	TRIPNO int,
	PTRIPS int,
	ACCESSMODE int,
	O_ACCESSMODE VARCHAR(100),
	EGRESSMODE int,
	O_EGRESSMODE VARCHAR(100),
	OPNAME VARCHAR(100),
	DPNAME VARCHAR(100),
	OTAZ int,
	DTAZ int,
	ORIGIN_LONG real,
	origin_lat real,
	DEST_LONG real,
	dest_lat real,
	ORIGIN_DEPTIME int,
	DEST_ARRTIME int,
	PWGT real,
	EXPPWGT real,
	CONSTRAINT Place_pkey PRIMARY KEY (PLANO, PERNO, SAMPN)
);
BULK INSERT dbo.Place FROM "D:\Projects\ARC\Household_Travel_Data\PLACE.csv" WITH (
	FIELDTERMINATOR = ',', ROWTERMINATOR = '\n', FIRSTROW = 2, MAXERRORS = 0, TABLOCK);
----------------------------------------------------------------------------------------

--Create actpriority table and insert data FROM activities.csv file
CREATE TABLE actpriority(
	tpurp int,
	tpurp_lab VARCHAR(120),
	purp int,
	purp_label VARCHAR(25),
	d0 real,
	d60 real,
	d120 real,
	d180 real,
	d240 real,
	d300 real,
	d360 real,
	d420 real,
	d480 real
);
BULK INSERT dbo.actpriority FROM 'D:\Projects\ARC\Household_Travel_Data\Activities.csv' WITH (
	FIELDTERMINATOR = ',', ROWTERMINATOR = '\n', FIRSTROW = 2, MAXERRORS = 0, TABLOCK);
---------------------------------------------------------------------------------------------------------------------
	
--Create TotalTourFile Table (populated during the execution process)
CREATE TABLE dbo.TotalTourFile (
	HH_ID int,
	PER_ID int,
	TOUR_ID int,
	ORIG_PLACENO int,
	DEST_PLACENO int,
	ORIG_X real,
	ORIG_Y real,
	ORIG_TAZ int,
	DEST_X real,
	DEST_Y real,
	DEST_TAZ int,
	TOURPURP VARCHAR(25),
	TOURMODE VARCHAR(25),
	DRIVER int,
	ANCHOR_DEPART_HOUR int,
	ANCHOR_DEPART_MIN int,
	PRIMDEST_ARRIVE_HOUR int,
	PRIMDEST_ARRIVE_MIN int,
	PRIMDEST_DEPART_HOUR int,
	PRIMDEST_DEPART_MIN int,
	ANCHOR_ARRIVE_HOUR int, 
	ANCHOR_ARRIVE_MIN int,
	TOUR_DUR_HR int,
	TOUR_DUR_MIN int,
	IS_SUBTOUR int,
	PARENT_TOUR_ID int,
	PARENT_TOUR_MODE VARCHAR(25),
	HAS_SUBTOUR int,
	CHILD_TOUR_ID VARCHAR(25),
	OUTBOUND_STOPS int,
	INBOUND_STOPS int,
	OSTOP_1_PLACENO int,
	OSTOP_1_X real,
	OSTOP_1_Y real,
	OSTOP_1_ARR_HR int,
	OSTOP_1_ARR_MIN int,
	OSTOP_1_DEP_HR int,
	OSTOP_1_DEP_MIN int,
	OSTOP_1_DUR_HR int,
	OSTOP_1_DUR_MIN int,
	OSTOP_1_PURP VARCHAR(25),
	OSTOP_2_PLACENO int,
	OSTOP_2_X real,
	OSTOP_2_Y real,
	OSTOP_2_ARR_HR int,
	OSTOP_2_ARR_MIN int,
	OSTOP_2_DEP_HR int,
	OSTOP_2_DEP_MIN int,
	OSTOP_2_DUR_HR int,
	OSTOP_2_DUR_MIN int,
	OSTOP_2_PURP VARCHAR(25),
	OSTOP_3_PLACENO int,
	OSTOP_3_X real,
	OSTOP_3_Y real,
	OSTOP_3_ARR_HR int,
	OSTOP_3_ARR_MIN int,
	OSTOP_3_DEP_HR int,
	OSTOP_3_DEP_MIN int,
	OSTOP_3_DUR_HR int,
	OSTOP_3_DUR_MIN int,
	OSTOP_3_PURP VARCHAR(25),
	OSTOP_4_PLACENO int,
	OSTOP_4_X real,
	OSTOP_4_Y real,
	OSTOP_4_ARR_HR int,
	OSTOP_4_ARR_MIN int,
	OSTOP_4_DEP_HR int,
	OSTOP_4_DEP_MIN int,
	OSTOP_4_DUR_HR int,
	OSTOP_4_DUR_MIN int,
	OSTOP_4_PURP VARCHAR(25),
	ISTOP_1_PLACENO int,
	ISTOP_1_X real,
	ISTOP_1_Y real,
	ISTOP_1_ARR_HR int,
	ISTOP_1_ARR_MIN int,
	ISTOP_1_DEP_HR int,
	ISTOP_1_DEP_MIN int,
	ISTOP_1_DUR_HR int,
	ISTOP_1_DUR_MIN int,
	ISTOP_1_PURP VARCHAR(25),
	ISTOP_2_PLACENO int,
	ISTOP_2_X real,
	ISTOP_2_Y real,
	ISTOP_2_ARR_HR int,
	ISTOP_2_ARR_MIN int,
	ISTOP_2_DEP_HR int,
	ISTOP_2_DEP_MIN int,
	ISTOP_2_DUR_HR int,
	ISTOP_2_DUR_MIN int,
	ISTOP_2_PURP VARCHAR(25),
	ISTOP_3_PLACENO int,
	ISTOP_3_X real,
	ISTOP_3_Y real,
	ISTOP_3_ARR_HR int,
	ISTOP_3_ARR_MIN int,
	ISTOP_3_DEP_HR int,
	ISTOP_3_DEP_MIN int,
	ISTOP_3_DUR_HR int,
	ISTOP_3_DUR_MIN int,
	ISTOP_3_PURP VARCHAR(25),
	ISTOP_4_PLACENO int,
	ISTOP_4_X real,
	ISTOP_4_Y real,
	ISTOP_4_ARR_HR int,
	ISTOP_4_ARR_MIN int,
	ISTOP_4_DEP_HR int,
	ISTOP_4_DEP_MIN int,
	ISTOP_4_DUR_HR int,
	ISTOP_4_DUR_MIN int,
	ISTOP_4_PURP VARCHAR(25)
	);
CREATE NONCLUSTERED INDEX ix_TotalTourFile_HH_ID_PER_ID_TOUR_ID
ON dbo.TotalTourFile (HH_ID,PER_ID,TOUR_ID)
----------------------------------------------------------------------------------------
--Create TotalTripFile Table (populated during the execution process)
CREATE TABLE dbo.TotalTripFile (
	HH_ID int,
	PER_ID int,
	TOUR_ID int,
	TRIP_ID int,
	ORIG_X real,
	ORIG_Y real,
	ORIG_TAZ int,
	DEST_X real,
	DEST_Y real,
	DEST_TAZ int,
	ORIG_PURP VARCHAR(25),
	DEST_PURP VARCHAR(25),
	ORIG_ARR_HR int,
	ORIG_ARR_MIN int,
	ORIG_DEP_HR int,
	ORIG_DEP_MIN int,
	DEST_ARR_HR int,
	DEST_ARR_MIN int,
	DEST_DEP_HR int,
	DEST_DEP_MIN int,
	TRIP_DUR_HR int,
	TRIP_DUR_MIN int,
	TRIPMODE int,
	DRIVER int,
	AUTO_OCC int,
	TOURMODE VARCHAR(25),
	TOURPURP VARCHAR(25),
	BOARDING_PLACENO int,
	BOARDING_PNAME VARCHAR(100),
	BOARDING_X real,
	BOARDING_Y real,
	ALIGHTING_PLACENO int,
	ALIGHTING_PNAME VARCHAR(100),
	ALIGHTING_X real,
	ALIGHTING_Y real,
	PARKING_PLACENO int,
	PARKING_PNAME VARCHAR(100),
	PARKING_X real,
	PARKING_Y real,
	SUBTOUR int,
	IS_INBOUND int,
	TRIPS_ON_JOURNEY int,
	TRIPS_ON_TOUR int,
	ORIG_IS_TOUR_ORIG int,
	ORIG_IS_TOUR_DEST int,
	DEST_IS_TOUR_DEST int,
	DEST_IS_TOUR_ORIG int
	);
CREATE NONCLUSTERED INDEX ix_TotalTripFile_HH_ID_PER_ID_TOUR_ID_TRIP_ID
ON dbo.TotalTripFile (HH_ID,PER_ID,TOUR_ID,TRIP_ID)
----------------------------------------------------------------------------------------
--Create ReqdTable Table (populated and truncated during the execution process in Part-4)
CREATE TABLE dbo.ReqdTable (
	hhseq bigint,
	SAMPN int,
	PERNO int,
	PLANO int,
	PNAME VARCHAR(100),
	TOTTR int,
	ARR_HR int,
	ARR_MIN int,
	DEP_HR int,
	DEP_MIN int,
	ACTDUR int,
	TRPDUR int,
	TRIPDIST real,
	PTAZ int,
	XCORD real,
	YCORD real,
	OPNAME VARCHAR(100),
	DPNAME VARCHAR(100),
	OTAZ int,
	DTAZ int,
	ORIGIN_LONG real,
	origin_lat real,
	DEST_LONG real,
	dest_lat real,
	ORIGIN_DEPTIME int,
	DEST_ARRTIME int,
	AGGACT VARCHAR(25),
	MODENAME VARCHAR(25),
	Ro_gen int,
	MODECODE int,
	BOARDING_PLACENO int,
	BOARDING_PNAME VARCHAR(100),
	BOARDING_X real,
	BOARDING_Y real,
	ALIGHTING_PLACENO int,
	ALIGHTING_PNAME VARCHAR(100),
	ALIGHTING_X real,
	ALIGHTING_Y real,
	PARKING_PLACENO int,
	PARKING_PNAME VARCHAR(100),
	PARKING_X real,
	PARKING_Y real,
	BEGTOURNUM int,
	TourRecord int,
	BegTourIndex int,
	BEGWORKSUBTOURNUM int,
	WorkTourRecord int,
	BegWorkTourIndex int,
	PrimDest int,
	ORIG_PLACENO int,
	DEST_PLACENO int,
	ORIG_X real,
	ORIG_Y real,
	ORIG_TAZ int,
	DEST_X real,
	DEST_Y real,
	DEST_TAZ int,
	TOURPURP VARCHAR(25),
	TOURMODE VARCHAR(25),
	DRIVER int,
	ANCHOR_DEPART_HOUR int,
	ANCHOR_DEPART_MIN int,
	PRIMDEST_ARRIVE_HOUR int,
	PRIMDEST_ARRIVE_MIN int,
	PRIMDEST_DEPART_HOUR int,
	PRIMDEST_DEPART_MIN int,
	ANCHOR_ARRIVE_HOUR int,
	ANCHOR_ARRIVE_MIN int,
	TOUR_DUR_HR int,
	TOUR_DUR_MIN int,
	IS_SUBTOUR int,
	PARENT_TOUR_ID int,
	PARENT_TOUR_MODE VARCHAR(25),
	HAS_SUBTOUR int,
	CHILD_TOUR_ID VARCHAR(25),
	OUTBOUND_STOPS int,
	INBOUND_STOPS int,
	OSTOP_1_PLACENO int,
	OSTOP_1_X real,
	OSTOP_1_Y real,
	OSTOP_1_ARR_HR int,
	OSTOP_1_ARR_MIN int,
	OSTOP_1_DEP_HR int,
	OSTOP_1_DEP_MIN int,
	OSTOP_1_DUR_HR int,
	OSTOP_1_DUR_MIN int,
	OSTOP_1_PURP VARCHAR(25),
	OSTOP_2_PLACENO int,
	OSTOP_2_X real,
	OSTOP_2_Y real,
	OSTOP_2_ARR_HR int,
	OSTOP_2_ARR_MIN int,
	OSTOP_2_DEP_HR int,
	OSTOP_2_DEP_MIN int,
	OSTOP_2_DUR_HR int,
	OSTOP_2_DUR_MIN int,
	OSTOP_2_PURP VARCHAR(25),
	OSTOP_3_PLACENO int,
	OSTOP_3_X real,
	OSTOP_3_Y real,
	OSTOP_3_ARR_HR int,
	OSTOP_3_ARR_MIN int,
	OSTOP_3_DEP_HR int,
	OSTOP_3_DEP_MIN int,
	OSTOP_3_DUR_HR int,
	OSTOP_3_DUR_MIN int,
	OSTOP_3_PURP VARCHAR(25),
	OSTOP_4_PLACENO int,
	OSTOP_4_X real,
	OSTOP_4_Y real,
	OSTOP_4_ARR_HR int,
	OSTOP_4_ARR_MIN int,
	OSTOP_4_DEP_HR int,
	OSTOP_4_DEP_MIN int,
	OSTOP_4_DUR_HR int,
	OSTOP_4_DUR_MIN int,
	OSTOP_4_PURP VARCHAR(25),
	ISTOP_1_PLACENO int,
	ISTOP_1_X real,
	ISTOP_1_Y real,
	ISTOP_1_ARR_HR int,
	ISTOP_1_ARR_MIN int,
	ISTOP_1_DEP_HR int,
	ISTOP_1_DEP_MIN int,
	ISTOP_1_DUR_HR int,
	ISTOP_1_DUR_MIN int,
	ISTOP_1_PURP VARCHAR(25),
	ISTOP_2_PLACENO int,
	ISTOP_2_X real,
	ISTOP_2_Y real,
	ISTOP_2_ARR_HR int,
	ISTOP_2_ARR_MIN int,
	ISTOP_2_DEP_HR int,
	ISTOP_2_DEP_MIN int,
	ISTOP_2_DUR_HR int,
	ISTOP_2_DUR_MIN int,
	ISTOP_2_PURP VARCHAR(25),
	ISTOP_3_PLACENO int,
	ISTOP_3_X real,
	ISTOP_3_Y real,
	ISTOP_3_ARR_HR int,
	ISTOP_3_ARR_MIN int,
	ISTOP_3_DEP_HR int,
	ISTOP_3_DEP_MIN int,
	ISTOP_3_DUR_HR int,
	ISTOP_3_DUR_MIN int,
	ISTOP_3_PURP VARCHAR(25),
	ISTOP_4_PLACENO int,
	ISTOP_4_X real,
	ISTOP_4_Y real,
	ISTOP_4_ARR_HR int,
	ISTOP_4_ARR_MIN int,
	ISTOP_4_DEP_HR int,
	ISTOP_4_DEP_MIN int,
	ISTOP_4_DUR_HR int,
	ISTOP_4_DUR_MIN int,
	ISTOP_4_PURP VARCHAR(25),
	Trip_ID int,
	Tour_ID int,
	ORIG_ARR_HR int,
	ORIG_ARR_MIN int,
	ORIG_DEP_HR int,
	ORIG_DEP_MIN int,
	DEST_ARR_HR int,
	DEST_ARR_MIN int,
	DEST_DEP_HR int,
	DEST_DEP_MIN int,
	TRIP_DUR_HR int,
	TRIP_DUR_MIN int,
	ORIG_PURP VARCHAR(25), 
	DEST_PURP VARCHAR(25),
	SUBTOUR int,
	IS_INBOUND int,
	AUTO_OCC int,
	TRIPS_ON_JOURNEY int,
	TRIPS_ON_TOUR int,
	ORIG_IS_TOUR_ORIG int,
	ORIG_IS_TOUR_DEST int,
	DEST_IS_TOUR_DEST int,
	DEST_IS_TOUR_ORIG int
);
----------------------
--END - Input Tables
----------------------

PRINT 'Part - 1 execution is over and end time of the process is : ' + CAST(SYSDATETIME() AS VARCHAR)